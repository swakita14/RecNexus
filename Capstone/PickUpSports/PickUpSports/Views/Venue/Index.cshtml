@model List<PickUpSports.Models.ViewModel.VenueViewModel>
@{
    ViewBag.Title = "Sports Venues";
}

<div class="page-header">
    <h3>Sports Venues and Fields</h3>
    <p>Find local venues to play your favorite sports at here!</p>
</div>

<h2>Map</h2>
<div id="map"></div>

<p>
    <div class="form-box">
    <h2>Sports Venues and Fields</h2>
    <div class="row">
        <center class="form-inline">
            <form class="form-inline">
                <div class="form-group">
                    <label for="endtime">Starting Time:</label>
                    <input type="text" class="form-control" id="time" name="time" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" required> &nbsp;
                </div>
                <div class="form-group">
                    <label for="day">Day of Week:</label>
                    @Html.DropDownList("day", new SelectList(Enum.GetValues(typeof(DayOfWeek))), new { @class = "form-control" }) &nbsp;
                </div>
                <button type="submit" class="btn btn-danger">Find Available Venues</button> &nbsp;
                <p style="color: red">@ViewBag.Message</p>
            </form>

            <br />
            @Html.ActionLink("SortByRating", "Index", new { sortBy = ViewBag.RateSort }, new { @class = "btn btn-danger" })
            @Html.ActionLink("Sort Venues by Distance", "Index", new { sortBy = ViewBag.DistanceSort }, new { @class = "btn btn-danger" })
        </center>
    </div>
    </div>
</p>

<ul class="rolldown-list" id="myList">
    <li>
        @foreach (var venue in Model)
        {
            <input type="hidden" value="@venue.VenueId" id="mapIn" />
            <div class="container">
                <div class="row">
                    @Html.DisplayFor(model => venue.Name)
                </div>
                <div class="row">
                    @Html.DisplayFor(model => venue.Address1), @Html.DisplayFor(model => venue.City), @Html.DisplayFor(model => venue.State), @Html.DisplayFor(model => venue.ZipCode)
                </div>
                <div class="row">
                    @Html.DisplayFor(model => venue.Phone)
                </div>


                <div class="row">
                    <br />@Html.ActionLink("Click here for details", "Details", new { id = venue.VenueId })
                </div>

            </div>
            <hr />
        }
    </li>
</ul>



<script>
    var x = document.getElementById("demo");

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {
        var lat = position.coords.latitude;
        var long = position.coords.longitude;
        jQuery.ajax({
            type: "POST",
            url: "@Url.Action("Index", "Venue")",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ curLat: lat, curLong: long, sortBy: "Distance" }),
            success: function (data) {
                alert(data);
            },
            failure: function (errMsg) {
                alert(errMsg);
            }
        });


    }

    getLocation();

</script>
<script>



    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'),
            {
                center: { lat: -25.344, lng: 131.036 },
                zoom: 10
            });

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                map.setCenter(pos);
            });
        }



    }



    function ajax_call() {
        var id = document.getElementById("mapIn").value;
        $.ajax({
            type: 'GET',
            datType: 'json',
            url: '/Venue/MapResult/' + id,
            data: { id: id },
            success: displayResults ,
            error: errorOnAjax


        });
        console.log(id);
    }

    
    function displayResults(data) {
        var marker, i;
        for(i=0; i <data.length; i++)
         {
             marker = new google.maps.Marker({
                position: new google.maps.LatLng(data[1], data[0]),
                map: map
            });
            console.log(marker);
        };

        console.log(data);
    }
    function errorOnAjax() {
        console.log("Ajax Error");
    }

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5bwiGQe1zyt3pWzQ9scBzcwOJyFJDsMQ&callback=initMap"></script>



