@model List<PickUpSports.Models.ViewModel.VenueViewModel>
@{
    ViewBag.Title = "Sports Venues";
}

<div class="page-header">
    <h3>Sports Venues and Fields</h3>
    <p>Find local venues to play your favorite sports at here!</p>
</div>

<p>
    <div class="row">
        <center class="form-inline">
            <form class="form-inline">
                <div class="form-group">
                    <label for="endtime">Starting Time:</label>
                    <input type="text" class="form-control" id="time" name="time" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" required> &nbsp;
                </div>
                <div class="form-group">
                    <label for="day">Day of Week:</label>
                    @Html.DropDownList("day", new SelectList(Enum.GetValues(typeof(DayOfWeek))), new { @class = "form-control" }) &nbsp;
                </div>
                <button type="submit" class="btn btn-outline-dark">Find Available Venues</button> &nbsp;
<p style="color: red">@ViewBag.Message</p>
            </form>
<br />
<button type="button" class="btn btn-outline-dark" onclick="location.href = '@Url.Action("Index", "Venue", new {sortBy = "RatingDesc"})'">Sort by Rating</button>
<button type="button" class="btn btn-outline-dark" onclick="getLocation()">Sort by Distance</button>
        </center>
    </div>
</p>
<ul class="rolldown-list" id="myList">
    <li>
        @foreach (var venue in Model)
        {
            <div class="container">
                <div class="row">
                    @Html.DisplayFor(model => venue.Name)
                </div>
                <div class="row">
                    @Html.DisplayFor(model => venue.Address1), @Html.DisplayFor(model => venue.City), @Html.DisplayFor(model => venue.State), @Html.DisplayFor(model => venue.ZipCode)
                </div>
                <div class="row">
                    @Html.DisplayFor(model => venue.Phone)
                </div>
                <div class="row">
                    @Html.DisplayFor(model => venue.Distance)
                </div>

                <div class="row">
                    <br />@Html.ActionLink("Click here for details", "Details", new { id = venue.VenueId })
                </div>

            </div>
            <hr />
        }
    </li>
</ul>


<script>
    var x = document.getElementById("demo");

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {
        var lat = position.coords.latitude;
        var long = position.coords.longitude;
        jQuery.ajax({
            type: "POST",
            url: "@Url.Action("Index", "Venue")",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ curLat: lat, curLong: long, sortBy: "Distance" }),
            success: function (data) {
                alert(data);
            },
            failure: function (errMsg) {
                alert(errMsg);
            }
        });
    }

    getLocation();

</script>


